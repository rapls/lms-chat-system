# LMSチャットシステム プロジェクト概要

## プロジェクトの目的
WordPress ベースの高度なリアルタイムチャットシステム。企業レベルのチャットアプリケーションとして、Long Polling によるメッセージ受信、リアクション機能、スレッド機能、プッシュ通知、ファイル共有、高機能キャッシュシステムを実装。

## 主要機能
- **リアルタイムメッセージング**: Long Polling（最大30秒間待機）
- **スレッド機能**: メッセージへの返信スレッド
- **リアクション機能**: 絵文字リアクション（即時ハイドレーション対応）
- **プッシュ通知**: Web Push API対応
- **ファイル共有**: アップロード・ダウンロード機能
- **検索機能**: リアルタイム検索とハイライト
- **未読バッジシステム**: 多層バッジ管理（グローバル・チャンネル・スレッド）
- **高機能キャッシュシステム**: 多層キャッシュ戦略

## ディレクトリ構造概要
- `/js/`: JavaScriptモジュール群（43ファイル）
  - コアシステム、リアルタイム通信、リアクション機能（7モジュール）
  - 検索・スクロール、スレッド、未読バッジ、パフォーマンス最適化
- `/includes/`: PHPクラス群（33ファイル）
  - チャットシステム、キャッシュ、セキュリティ、データ管理、管理機能
- `/sass/`: SCSS（BEM記法）
- `/admin/`: 管理画面

## セッション制御ポリシー
- すべてのセッション操作は`acquireSession()`/`releaseSession()`ヘルパー経由
- 読み取り専用時は`session_read_only`利用でロック即座解放
- `$_SESSION`直接アクセスと`session_start()`個別呼び出し禁止

## クリーンアップ履歴（2025-09-17）
- デバッグ・テストファイル24個削除
- シェルスクリプト5個削除
- console.logとerror_log削除（本番環境クリーンアップ）
- 現在: JS 43個、PHP（includes）33個

## データベース構造
- `wp_lms_chat_messages`: メインメッセージ
- `wp_lms_chat_thread_messages`: スレッドメッセージ
- `wp_lms_chat_channels`: チャンネル
- `wp_lms_chat_reactions`: リアクション
- `wp_lms_chat_thread_reactions`: スレッドリアクション
- その他: メンバー、最終閲覧時刻等

最終更新: 2025-09-19