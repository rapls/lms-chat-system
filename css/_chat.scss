/**
 * LMS ãƒãƒ£ãƒƒãƒˆæœªèª­ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ç”¨ SCSS
 * æ–°è¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®Newãƒãƒ¼ã‚¯ã€æœªèª­ãƒãƒƒã‚¸ã€ã‚¹ãƒ¬ãƒƒãƒ‰è¿”ä¿¡æ•°ã®ã‚¹ã‚¿ã‚¤ãƒ«
 */

// ====================
// NEW ãƒãƒ¼ã‚¯ã‚¹ã‚¿ã‚¤ãƒ«
// ====================

// åŸºæœ¬çš„ãª New ãƒãƒ¼ã‚¯ï¼ˆuser-nameã®å¾Œã«é…ç½®ã•ã‚Œã‚‹ï¼‰
.new-mark {
    background: linear-gradient(45deg, #ff4757, #ff3742);
    color: white;
    font-size: 9px;
    font-weight: bold;
    padding: 1px 4px;
    border-radius: 8px;
    margin-left: 6px;
    display: inline-block;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    box-shadow: 0 1px 2px rgba(255, 71, 87, 0.3);
    animation: newMarkPulse 1.5s infinite ease-in-out;
    vertical-align: middle;
    
    // ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¯¾å¿œ
    user-select: none;
    cursor: default;
    
    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆæ™‚ã®ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³
    transition: opacity 0.3s ease-out, transform 0.3s ease-out;
    
    // ãƒ›ãƒãƒ¼åŠ¹æœ
    &:hover {
        background: linear-gradient(45deg, #ff3742, #ff2730);
        transform: scale(1.05);
    }
}

// New ãƒãƒ¼ã‚¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
@keyframes newMarkPulse {
    0% { 
        transform: scale(1); 
        opacity: 1; 
    }
    50% { 
        transform: scale(1.05); 
        opacity: 0.9; 
        box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);
    }
    100% { 
        transform: scale(1); 
        opacity: 1; 
    }
}

// ã‚¹ãƒ¬ãƒƒãƒ‰å†…ã® New ãƒãƒ¼ã‚¯ï¼ˆå°ã•ã‚ï¼‰
.thread-info .new-mark,
.thread-message .new-mark {
    font-size: 8px;
    padding: 1px 4px;
    border-radius: 8px;
    margin-left: 4px;
    background: linear-gradient(45deg, #0052cc, #0065d9);
    color: #ffffff;
    border: 1px solid rgba(0, 82, 204, 0.3);
}

// ====================
// has-new-mark ã‚¯ãƒ©ã‚¹ä»˜ããƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¹ã‚¿ã‚¤ãƒ«
// ====================

.chat-message.has-new-mark,
.thread-message.has-new-mark,
.message-item.has-new-mark {
    background: linear-gradient(to right, 
        rgba(255, 107, 107, 0.05) 0%, 
        rgba(255, 107, 107, 0.02) 100%
    );
    border-left: 3px solid #ff6b6b;
    padding-left: calc(1rem - 3px);
    transition: all 0.3s ease;
    position: relative;
    
    // å¾®ç´°ãªå½±ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å¼·èª¿
    box-shadow: 0 1px 3px rgba(255, 107, 107, 0.1);
    
    &:hover {
        background: linear-gradient(to right, 
            rgba(255, 107, 107, 0.08) 0%, 
            rgba(255, 107, 107, 0.03) 100%
        );
    }
}

// New ãƒãƒ¼ã‚¯ä»˜ããƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚¿ã‚¤ãƒ«
.chat-message.has-new-mark .message-meta,
.thread-message.has-new-mark .message-meta,
.message-item.has-new-mark .message-meta,
.chat-message.has-new-mark .thread-message-meta,
.thread-message.has-new-mark .thread-message-meta {
    color: #333;
    font-weight: 500;
    
    .message-time {
        color: #ff6b6b;
        font-weight: 600;
    }
    
    .user-name {
        color: #2c3e50;
        font-weight: 600;
    }
}

// ====================
// æœªèª­ãƒãƒƒã‚¸ã‚¹ã‚¿ã‚¤ãƒ«
// ====================

.unread-badge {
    background: linear-gradient(45deg, #e74c3c, #c0392b);
    color: white;
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 10px;
    font-weight: bold;
    display: inline-block;
    min-width: 16px;
    text-align: center;
    box-shadow: 0 2px 4px rgba(231, 76, 60, 0.3);
    animation: badgePulse 2s infinite ease-in-out;
    
    // 0ã®å ´åˆã¯éè¡¨ç¤º
    &:empty,
    &[data-count="0"] {
        display: none;
    }
}

// ãƒãƒƒã‚¸ã®ãƒ‘ãƒ«ã‚¹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
@keyframes badgePulse {
    0%, 100% { 
        transform: scale(1); 
        opacity: 1;
    }
    50% { 
        transform: scale(1.1); 
        opacity: 0.8;
        box-shadow: 0 2px 8px rgba(231, 76, 60, 0.5);
    }
}

// ãƒ˜ãƒƒãƒ€ãƒ¼ãƒãƒ£ãƒƒãƒˆã‚¢ã‚¤ã‚³ãƒ³ã®æœªèª­ãƒãƒƒã‚¸
.chat-icon .unread-badge,
.header-chat-icon .unread-badge,
.chat-icon-wrapper .unread-badge {
    position: absolute !important;
    top: -8px !important;
    right: -8px !important;
    background: #ff4757 !important;
    color: white !important;
    font-size: 10px !important;
    font-weight: bold !important;
    min-width: 16px !important;
    padding: 2px 6px !important;
    border: 2px solid white !important;
    border-radius: 10px !important;
    box-shadow: 0 2px 6px rgba(255, 71, 87, 0.4) !important;
    text-align: center !important;
    line-height: 1 !important;
    z-index: 9999 !important;
    display: inline-block !important;
    
    // 0ã¾ãŸã¯ç©ºã®å ´åˆã¯éè¡¨ç¤º
    &:empty,
    &[data-count="0"] {
        display: none !important;
    }
}

// ãƒãƒ£ãƒƒãƒˆã‚¢ã‚¤ã‚³ãƒ³ã®è¦ªè¦ç´ ã‚’ç›¸å¯¾é…ç½®ã«
.chat-icon-wrapper,
.chat-icon {
    position: relative !important;
}

// ãƒãƒ£ãƒ³ãƒãƒ«æœªèª­ãƒãƒƒã‚¸
.channel-unread-badge,
.channel-item .unread-badge {
    margin-left: 8px;
    background: linear-gradient(45deg, #3742fa, #2f3542);
    font-size: 9px;
    padding: 1px 5px;
}

// ã‚¹ãƒ¬ãƒƒãƒ‰æœªèª­ãƒãƒƒã‚¸
.thread-unread-badge,
.thread-info .unread-badge {
    margin-left: 6px;
    background: linear-gradient(45deg, #26de81, #20bf6b);
    font-size: 8px;
    padding: 1px 4px;
    border-radius: 8px;
}

// ç·Šæ€¥å¯¾å¿œç”¨ã®çµ¶å¯¾é…ç½®Newãƒãƒ¼ã‚¯
.emergency-new-mark {
    position: absolute;
    top: 5px;
    right: 5px;
    background: linear-gradient(45deg, #ff4757, #ff3742) !important;
    color: white !important;
    padding: 2px 6px !important;
    border-radius: 10px !important;
    font-size: 10px !important;
    font-weight: bold !important;
    z-index: 1000 !important;
    animation: newMarkPulse 1.5s infinite ease-in-out !important;
    box-shadow: 0 2px 6px rgba(255, 71, 87, 0.4) !important;
    text-transform: uppercase !important;
    letter-spacing: 0.3px !important;
    border: 1px solid rgba(255, 255, 255, 0.3) !important;
}

// å¼·åˆ¶è¡¨ç¤ºãƒãƒƒã‚¸
.force-channel-badge {
    background: #ff4444 !important;
    display: inline-block !important;
    animation: forceChannelBadge 0.5s ease-out;
}

.force-thread-badge {
    background: #007cba !important;
    display: inline-block !important;
    animation: forceThreadBadge 0.5s ease-out;
}

// ç·Šæ€¥å¯¾å¿œãƒãƒƒã‚¸
.emergency-global-badge,
.absolute-channel-badge,
.absolute-thread-badge {
    position: fixed;
    background: #ff4444;
    color: white;
    padding: 8px 12px;
    border-radius: 20px;
    font-weight: bold;
    z-index: 9999;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    animation: emergencyBadge 0.8s ease-out;
}

.emergency-global-badge {
    top: 20px;
    right: 20px;
}

.absolute-channel-badge {
    background: #007cba;
    top: 60px;
    right: 20px;
}

.absolute-thread-badge {
    background: #007cba;
    top: 100px;
    right: 20px;
}

// ç·Šæ€¥å¯¾å¿œã‚¹ãƒ¬ãƒƒãƒ‰è¿”ä¿¡æ•°
.emergency-thread-count {
    position: absolute;
    bottom: 5px;
    right: 5px;
    background: #007cba;
    color: white;
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 10px;
    z-index: 999;
    animation: emergencyThread 0.5s ease-out;
}

// è¿½åŠ ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
@keyframes forceChannelBadge {
    0% {
        transform: scale(0.8);
        opacity: 0;
    }
    100% {
        transform: scale(1);
        opacity: 1;
    }
}

@keyframes forceThreadBadge {
    0% {
        transform: scale(0.8);
        opacity: 0;
    }
    100% {
        transform: scale(1);
        opacity: 1;
    }
}

@keyframes emergencyBadge {
    0% {
        transform: translateX(100%) scale(0.8);
        opacity: 0;
    }
    100% {
        transform: translateX(0) scale(1);
        opacity: 1;
    }
}

@keyframes emergencyThread {
    0% {
        transform: scale(0.5);
        opacity: 0;
    }
    100% {
        transform: scale(1);
        opacity: 1;
    }
}

// ====================
// ã‚¹ãƒ¬ãƒƒãƒ‰è¿”ä¿¡æ•°ã‚¹ã‚¿ã‚¤ãƒ«
// ====================

.reply-count,
.thread-replies-count,
.thread-count {
    font-size: 12px;
    color: #7f8c8d;
    font-weight: 500;
    margin-left: 8px;
    display: inline-block;
    
    &::before {
        content: "ğŸ’¬";
        margin-right: 4px;
        font-size: 10px;
    }
    
    // ãƒ›ãƒãƒ¼æ™‚ã®å¼·èª¿
    .thread-info:hover & {
        color: #34495e;
        font-weight: 600;
    }
}

// ====================
// ã‚¹ãƒ¬ãƒƒãƒ‰æƒ…å ±ã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ«
// ====================

.thread-info {
    padding: 8px 12px;
    background: rgba(52, 73, 94, 0.05);
    border-radius: 8px;
    margin-top: 8px;
    border-left: 3px solid #bdc3c7;
    transition: all 0.3s ease;
    
    &:hover {
        background: rgba(52, 73, 94, 0.08);
        border-left-color: #34495e;
    }
    
    // æœªèª­ãŒã‚ã‚‹å ´åˆã®å¼·èª¿
    &.has-unread {
        border-left-color: #26de81;
        background: rgba(38, 222, 129, 0.08);
        
        .reply-count {
            color: #20bf6b;
            font-weight: 600;
        }
    }
}

// ====================
// ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ
// ====================

@media (max-width: 768px) {
    .new-mark {
        font-size: 9px;
        padding: 1px 4px;
        margin-left: 6px;
    }
    
    .unread-badge {
        font-size: 9px;
        padding: 1px 4px;
        min-width: 14px;
    }
    
    .reply-count {
        font-size: 11px;
        margin-left: 6px;
    }
}

@media (max-width: 480px) {
    .new-mark {
        font-size: 8px;
        padding: 1px 3px;
        margin-left: 4px;
    }
    
    .unread-badge {
        font-size: 8px;
        padding: 1px 3px;
        min-width: 12px;
    }
    
    .thread-info {
        padding: 6px 8px;
        margin-top: 6px;
    }
    
    .reply-count {
        font-size: 10px;
        margin-left: 4px;
    }
}

// ====================
// ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã¨ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ
// ====================

// ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œï¼ˆãƒ—ãƒªãƒ•ã‚¡ãƒ¼ã•ã‚ŒãŸå ´åˆï¼‰
@media (prefers-color-scheme: dark) {
    .chat-message.has-new-mark,
    .thread-message.has-new-mark,
    .message-item.has-new-mark {
        background: linear-gradient(to right, 
            rgba(255, 107, 107, 0.1) 0%, 
            rgba(255, 107, 107, 0.05) 100%
        );
        border-left-color: #ff7979;
    }
    
    .thread-info {
        background: rgba(255, 255, 255, 0.1);
        border-left-color: #7f8c8d;
        
        &:hover {
            background: rgba(255, 255, 255, 0.15);
        }
    }
    
    .reply-count {
        color: #bdc3c7;
    }
}

// é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ
@media (prefers-contrast: high) {
    .new-mark {
        background: #d63031;
        border: 1px solid #fff;
        font-weight: 900;
    }
    
    .unread-badge {
        background: #e17055;
        border: 1px solid #fff;
    }
}

// ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç„¡åŠ¹è¨­å®šã«å¯¾å¿œ
@media (prefers-reduced-motion: reduce) {
    .new-mark,
    .unread-badge {
        animation: none;
    }
    
    .chat-message.has-new-mark,
    .thread-message.has-new-mark,
    .message-item.has-new-mark {
        transition: none;
    }
}

// ====================
// ãƒ•ã‚©ãƒ¼ã‚«ã‚¹çŠ¶æ…‹ï¼ˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ï¼‰
// ====================

.thread-info:focus,
.thread-toggle:focus {
    outline: 2px solid #74b9ff;
    outline-offset: 2px;
    border-radius: 4px;
}

// ====================
// ãƒ˜ãƒƒãƒ€ãƒ¼ãƒãƒ£ãƒƒãƒˆã‚¢ã‚¤ã‚³ãƒ³æœªèª­ãƒãƒƒã‚¸
// ====================

.site-header {
    .chat-icon-wrapper {
        position: relative;
        display: inline-block;
        z-index: 9998;
        
        .chat-icon {
            position: relative;
            display: inline-block;
            padding: 8px;
            transition: transform 0.2s ease;
            z-index: 9998;
            
            &:hover {
                transform: scale(1.1);
            }
            
            img {
                width: 32px;
                height: 32px;
                transition: filter 0.2s ease;
                
                .chat-icon:hover & {
                    filter: brightness(1.2);
                }
            }
            
            // ãƒ˜ãƒƒãƒ€ãƒ¼ãƒãƒƒã‚¸ï¼ˆæœ€é‡è¦ï¼‰
            .unread-badge {
                position: absolute;
                top: 0;
                right: 0;
                background: linear-gradient(45deg, #ff4757, #ff3742);
                color: white !important;
                border-radius: 50%;
                min-width: 20px;
                min-height: 20px;
                font-size: 11px;
                font-weight: bold;
                display: flex;
                align-items: center;
                justify-content: center;
                line-height: 1;
                z-index: 9999 !important;
                box-shadow: 0 2px 8px rgba(255, 71, 87, 0.5);
                border: 2px solid white;
                transform: translate(50%, -50%);
                text-align: center;
                vertical-align: middle;
                
                // ãƒ†ã‚­ã‚¹ãƒˆè¦ç´ ã®ç¢ºå®Ÿãªè¡¨ç¤º
                &, & * {
                    color: white !important;
                    z-index: 9999 !important;
                    position: relative;
                    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
                }
                
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§éè¡¨ç¤º
                opacity: 0;
                visibility: hidden;
                transform: translate(50%, -50%) scale(0);
                transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
                
                // ç©ºã®å ´åˆã¯æœ€å„ªå…ˆã§éè¡¨ç¤ºï¼ˆæœ€é‡è¦ãƒ«ãƒ¼ãƒ«ï¼‰
                &:empty {
                    display: none !important;
                    opacity: 0 !important;
                    visibility: hidden !important;
                    transform: translate(50%, -50%) scale(0) !important;
                    background: none !important;
                    border: none !important;
                    box-shadow: none !important;
                    width: 0 !important;
                    height: 0 !important;
                    min-width: 0 !important;
                    min-height: 0 !important;
                }
                
                // è¡¨ç¤ºçŠ¶æ…‹ï¼ˆãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚‹å ´åˆã®ã¿ï¼‰
                &.visible:not(:empty),
                &.show:not(:empty),
                &.has-content:not(:empty) {
                    display: flex !important;
                    opacity: 1 !important;
                    visibility: visible !important;
                    transform: translate(50%, -50%) scale(1) !important;
                    color: white !important;
                    background: linear-gradient(45deg, #ff4757, #ff3742) !important;
                    border-radius: 50% !important;
                    min-width: 20px !important;
                    min-height: 20px !important;
                    font-size: 11px !important;
                    font-weight: bold !important;
                    align-items: center !important;
                    justify-content: center !important;
                    line-height: 1 !important;
                    z-index: 99999 !important;
                    box-shadow: 0 2px 8px rgba(255, 71, 87, 0.5) !important;
                    border: 2px solid white !important;
                    text-align: center !important;
                    vertical-align: middle !important;
                    
                    // å†…éƒ¨ãƒ†ã‚­ã‚¹ãƒˆã®å¼·åˆ¶è¡¨ç¤º
                    &::before,
                    &::after {
                        content: none;
                    }
                }
                
                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ
                &.visible {
                    animation: headerBadgeBounce 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
                }
                
                // ãƒ›ãƒãƒ¼åŠ¹æœ
                &:hover {
                    transform: translate(50%, -50%) scale(1.1);
                    background: linear-gradient(45deg, #ff3742, #ff2730);
                    box-shadow: 0 4px 12px rgba(255, 71, 87, 0.7);
                }
                
                // æ•°å­—ãŒ2æ¡ä»¥ä¸Šã®å ´åˆ
                &.multi-digit {
                    min-width: 24px;
                    padding: 0 4px;
                    border-radius: 12px;
                }
            }
        }
    }
}

// ãƒãƒƒã‚¸ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
@keyframes headerBadgeBounce {
    0% {
        opacity: 0;
        transform: translate(50%, -50%) scale(0);
    }
    50% {
        opacity: 1;
        transform: translate(50%, -50%) scale(1.2);
    }
    100% {
        opacity: 1;
        transform: translate(50%, -50%) scale(1);
    }
}

// ãƒãƒƒã‚¸ç‚¹æ»…ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ–°ç€æ™‚ï¼‰
@keyframes headerBadgePulse {
    0%, 100% {
        box-shadow: 0 2px 8px rgba(255, 71, 87, 0.5);
    }
    50% {
        box-shadow: 0 4px 16px rgba(255, 71, 87, 0.8);
        transform: translate(50%, -50%) scale(1.05);
    }
}

// æ–°ç€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ™‚ã®ç‚¹æ»…
.site-header .chat-icon-wrapper .chat-icon .unread-badge.new-message {
    animation: headerBadgePulse 1.5s ease-in-out 3;
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ
@media (max-width: 768px) {
    .site-header .chat-icon-wrapper {
        .chat-icon {
            padding: 6px;
            
            img {
                width: 28px;
                height: 28px;
            }
            
            .unread-badge {
                min-width: 18px;
                min-height: 18px;
                font-size: 10px;
                
                &.multi-digit {
                    min-width: 22px;
                    padding: 0 3px;
                    border-radius: 11px;
                }
            }
        }
    }
}

// ç©ºã®ãƒãƒƒã‚¸ã‚’ç¢ºå®Ÿã«éè¡¨ç¤ºã«ã™ã‚‹æœ€å„ªå…ˆãƒ«ãƒ¼ãƒ«
.site-header .chat-icon-wrapper .chat-icon .unread-badge:empty {
    display: none !important;
    opacity: 0 !important;
    visibility: hidden !important;
    transform: translate(50%, -50%) scale(0) !important;
    background: none !important;
    border: none !important;
    box-shadow: none !important;
    width: 0 !important;
    height: 0 !important;
    min-width: 0 !important;
    min-height: 0 !important;
}

// ç©ºã®ãƒãƒƒã‚¸ãŒ visible ã‚„ show ã‚¯ãƒ©ã‚¹ã‚’æŒã£ã¦ã„ã¦ã‚‚å¼·åˆ¶çš„ã«éè¡¨ç¤º
.site-header .chat-icon-wrapper .chat-icon .unread-badge.visible:empty,
.site-header .chat-icon-wrapper .chat-icon .unread-badge.show:empty,
.site-header .chat-icon-wrapper .chat-icon .unread-badge.visible.show:empty {
    display: none !important;
    opacity: 0 !important;
    visibility: hidden !important;
    transform: translate(50%, -50%) scale(0) !important;
    background: none !important;
    border: none !important;
    box-shadow: none !important;
    width: 0 !important;
    height: 0 !important;
    min-width: 0 !important;
    min-height: 0 !important;
}

// ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ã®å¼·åˆ¶è¡¨ç¤ºã‚¯ãƒ©ã‚¹ï¼ˆãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚‹å ´åˆã®ã¿ï¼‰
.force-show-header-badge {
    .site-header .chat-icon-wrapper .chat-icon .unread-badge:not(:empty) {
        opacity: 1 !important;
        visibility: visible !important;
        display: flex !important;
        transform: translate(50%, -50%) scale(1) !important;
        color: white !important;
        z-index: 99999 !important;
    }
}

// ãƒ˜ãƒƒãƒ€ãƒ¼ãƒãƒƒã‚¸å°‚ç”¨ã‚¯ãƒ©ã‚¹ï¼ˆç«¶åˆå›é¿ï¼‰
.site-header .chat-icon-wrapper .chat-icon .unread-badge.header-badge,
.site-header .chat-icon-wrapper .chat-icon .unread-badge.universal-header-badge {
    color: white !important;
    background: linear-gradient(45deg, #ff4757, #ff3742) !important;
    z-index: 99999 !important;
    
    // æ•°å­—ã®è¡¨ç¤ºã‚’æœ€å„ªå…ˆ
    &, &:before, &:after, & * {
        color: white !important;
        z-index: 99999 !important;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5) !important;
    }
}

// å…¨èˆ¬çš„ãªãƒãƒƒã‚¸ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºã®å¼·åŒ–
.unread-badge {
    // ç©ºã®ãƒãƒƒã‚¸ã¯çµ¶å¯¾ã«è¡¨ç¤ºã—ãªã„ï¼ˆæœ€å¼·ãƒ«ãƒ¼ãƒ«ï¼‰
    &:empty {
        display: none !important;
        opacity: 0 !important;
        visibility: hidden !important;
        width: 0 !important;
        height: 0 !important;
        min-width: 0 !important;
        min-height: 0 !important;
        background: none !important;
        border: none !important;
        box-shadow: none !important;
        transform: scale(0) !important;
    }
    
    &.visible,
    &.show {
        // ç©ºã§ãªã„å ´åˆã®ã¿è¡¨ç¤º
        &:not(:empty) {
            color: white !important;
            // ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ¼ãƒ‰ã®å¼·åˆ¶è¡¨ç¤º
            text-indent: 0 !important;
            text-decoration: none !important;
            overflow: visible !important;
            white-space: nowrap !important;
        }
        
        // ç©ºã®å ´åˆã¯å¼·åˆ¶éè¡¨ç¤º
        &:empty {
            display: none !important;
            opacity: 0 !important;
            visibility: hidden !important;
        }
    }
}

// unread-badge-hide ã‚¯ãƒ©ã‚¹ï¼ˆæœ€å¼·ã®éè¡¨ç¤ºãƒ«ãƒ¼ãƒ«ï¼‰
.unread-badge-hide {
    display: none !important;
    opacity: 0 !important;
    visibility: hidden !important;
    width: 0 !important;
    height: 0 !important;
    min-width: 0 !important;
    min-height: 0 !important;
    background: none !important;
    border: none !important;
    box-shadow: none !important;
    transform: scale(0) !important;
}

// unread-badge-hide ãŒä»˜ã„ã¦ã„ã‚Œã°ã©ã‚“ãªã‚¯ãƒ©ã‚¹çµ„ã¿åˆã‚ã›ã§ã‚‚éè¡¨ç¤º
.unread-badge.unread-badge-hide,
.unread-badge.visible.unread-badge-hide,
.unread-badge.show.unread-badge-hide,
.unread-badge.has-content.unread-badge-hide,
.unread-badge.visible.show.unread-badge-hide,
.unread-badge.visible.show.has-content.unread-badge-hide {
    display: none !important;
    opacity: 0 !important;
    visibility: hidden !important;
    width: 0 !important;
    height: 0 !important;
    min-width: 0 !important;
    min-height: 0 !important;
    background: none !important;
    border: none !important;
    box-shadow: none !important;
    transform: scale(0) !important;
}

// æœ€å¼·ã®ç©ºãƒãƒƒã‚¸éè¡¨ç¤ºãƒ«ãƒ¼ãƒ«ï¼ˆã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼è©³ç´°åº¦ã‚’æœ€å¤§ã«ï¼‰
body .site-header .header-container .chat-icon-wrapper .chat-icon .unread-badge:empty,
body .site-header .chat-icon-wrapper .chat-icon .unread-badge.visible:empty,
body .site-header .chat-icon-wrapper .chat-icon .unread-badge.show:empty,
body .site-header .chat-icon-wrapper .chat-icon .unread-badge.header-badge:empty,
body .site-header .chat-icon-wrapper .chat-icon .unread-badge.universal-header-badge:empty {
    display: none !important;
    opacity: 0 !important;
    visibility: hidden !important;
    width: 0 !important;
    height: 0 !important;
    min-width: 0 !important;
    min-height: 0 !important;
    background: none !important;
    border: none !important;
    box-shadow: none !important;
    transform: scale(0) !important;
}

// ====================
// ã‚¤ãƒ³ãƒ•ã‚£ãƒ‹ãƒ†ã‚£ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
// ====================

// é«˜å“è³ªãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¤ãƒ³ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ 
@keyframes premiumMessageSlideIn {
    0% {
        opacity: 0;
        transform: translate3d(0, -30px, 0) scale(0.92) rotateX(10deg);
        filter: blur(3px) brightness(0.8) contrast(0.9);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0);
    }
    25% {
        opacity: 0.3;
        transform: translate3d(0, -18px, 0) scale(0.95) rotateX(6deg);
        filter: blur(1.8px) brightness(0.85) contrast(0.95);
        box-shadow: 0 6px 24px rgba(0, 0, 0, 0.05);
    }
    60% {
        opacity: 0.8;
        transform: translate3d(0, -6px, 0) scale(0.98) rotateX(2deg);
        filter: blur(0.8px) brightness(0.92) contrast(0.98);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
    }
    85% {
        opacity: 0.95;
        transform: translate3d(0, -2px, 0) scale(1.01) rotateX(0deg);
        filter: blur(0.2px) brightness(0.96) contrast(1);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }
    100% {
        opacity: 1;
        transform: translate3d(0, 0, 0) scale(1) rotateX(0deg);
        filter: blur(0) brightness(1) contrast(1);
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.04);
    }
}

// æ—¥ä»˜ã‚»ãƒ‘ãƒ¬ãƒ¼ã‚¿ãƒ¼ç”¨ã®è»½ã‚„ã‹ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
@keyframes premiumSeparatorSlideIn {
    0% {
        opacity: 0;
        transform: translate3d(0, -20px, 0) scale(0.95);
        filter: blur(2px) brightness(0.9);
    }
    50% {
        opacity: 0.6;
        transform: translate3d(0, -8px, 0) scale(0.98);
        filter: blur(0.8px) brightness(0.94);
    }
    100% {
        opacity: 1;
        transform: translate3d(0, 0, 0) scale(1);
        filter: blur(0) brightness(1);
    }
}

// ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³åŠ¹æœ - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”¨ï¼ˆ!important ã§æ—¢å­˜CSSä¸Šæ›¸ãï¼‰
#chat-messages .chat-message.infinity-scroll-new-message {
    // ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚¢ã‚¯ã‚»ãƒ©ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æœ‰åŠ¹åŒ–
    will-change: transform, opacity, filter !important;
    
    // åˆæœŸçŠ¶æ…‹ - ã‚ˆã‚Šæ´—ç·´ã•ã‚ŒãŸè¨­å®š
    &.fade-in-ready {
        opacity: 0 !important;
        transform: translate3d(0, -30px, 0) scale(0.92) rotateX(10deg) !important;
        filter: blur(3px) brightness(0.8) contrast(0.9) !important;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0) !important;
        transition: none !important;
        animation: none !important;
        backface-visibility: hidden !important;
        perspective: 1000px !important;
    }
    
    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡ŒçŠ¶æ…‹ï¼ˆã‚ˆã‚Šã‚†ã£ãã‚Šï¼‰
    &.fade-in-active {
        animation: premiumMessageSlideIn 2.0s cubic-bezier(0.16, 1, 0.3, 1) forwards !important;
        transition: none !important;
    }
    
    // å®Œäº†å¾Œã®çŠ¶æ…‹ï¼ˆæœ€é©åŒ–ï¼‰
    &.fade-in-complete {
        will-change: auto !important;
        transform: translate3d(0, 0, 0) scale(1) rotateX(0deg) !important;
        filter: blur(0) brightness(1) contrast(1) !important;
        opacity: 1 !important;
        animation: none !important;
        transition: none !important;
    }
}

// ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³åŠ¹æœ - æ—¥ä»˜ã‚»ãƒ‘ãƒ¬ãƒ¼ã‚¿ãƒ¼ç”¨ï¼ˆ!important ã§ä¸Šæ›¸ãï¼‰
#chat-messages .date-separator {
    will-change: transform, opacity, filter !important;
    
    &.fade-in-ready {
        opacity: 0 !important;
        transform: translate3d(0, -20px, 0) scale(0.95) !important;
        filter: blur(2px) brightness(0.9) !important;
        transition: none !important;
        animation: none !important;
        backface-visibility: hidden !important;
    }
    
    &.fade-in-active {
        animation: premiumSeparatorSlideIn 1.5s cubic-bezier(0.16, 1, 0.3, 1) forwards !important;
        transition: none !important;
    }
    
    &.fade-in-complete {
        will-change: auto !important;
        transform: translate3d(0, 0, 0) scale(1) !important;
        filter: blur(0) brightness(1) !important;
        opacity: 1 !important;
        animation: none !important;
        transition: none !important;
    }
}

// ç‰¹åˆ¥ãªãƒã‚¤ã‚¯ãƒ­ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³åŠ¹æœï¼ˆ!important ã§ä¸Šæ›¸ãï¼‰
#chat-messages .chat-message.infinity-scroll-new-message.fade-in-active {
    // å¾®ç´°ãªå…‰æ²¢åŠ¹æœ
    &::after {
        content: '' !important;
        position: absolute !important;
        top: 0 !important;
        left: -100% !important;
        width: 100% !important;
        height: 100% !important;
        background: linear-gradient(
            90deg,
            transparent,
            rgba(255, 255, 255, 0.15) 50%,
            transparent
        ) !important;
        animation: shimmerEffect 2.5s ease-out 0.5s !important;
        pointer-events: none !important;
        z-index: 1 !important;
    }
}

@keyframes shimmerEffect {
    0% {
        left: -100%;
        opacity: 0;
    }
    50% {
        opacity: 1;
    }
    100% {
        left: 100%;
        opacity: 0;
    }
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ - ãƒ¢ãƒã‚¤ãƒ«ç”¨æœ€é©åŒ–ï¼ˆ!important ã§ä¸Šæ›¸ãï¼‰
@media (max-width: 768px) {
    #chat-messages .chat-message.infinity-scroll-new-message.fade-in-ready {
        transform: translate3d(0, -20px, 0) scale(0.95) !important;
        filter: blur(2px) brightness(0.85) !important;
    }
    
    #chat-messages .chat-message.infinity-scroll-new-message.fade-in-active {
        animation-duration: 1.6s !important;
    }
}

// ä½ã‚¹ãƒšãƒƒã‚¯ç«¯æœ«ç”¨ã®è»½é‡ç‰ˆï¼ˆ!important ã§ä¸Šæ›¸ãï¼‰
@media (prefers-reduced-motion: reduce) {
    #chat-messages .chat-message.infinity-scroll-new-message.fade-in-active,
    #chat-messages .date-separator.fade-in-active {
        animation: none !important;
        transition: opacity 0.3s ease-out, transform 0.3s ease-out !important;
        opacity: 1 !important;
        transform: translate3d(0, 0, 0) scale(1) rotateX(0deg) !important;
        filter: none !important;
    }
}

// ====================
// ãƒ‡ãƒãƒƒã‚°ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆé–‹ç™ºæ™‚ã®ã¿ï¼‰
// ====================

// .debug-unread-system {
//     .has-new-mark {
//         border: 2px dashed #ff6b6b !important;
//     }
//     
//     .new-mark {
//         border: 1px solid yellow !important;
//     }
//     
//     .unread-badge {
//         border: 1px solid lime !important;
//     }
// }